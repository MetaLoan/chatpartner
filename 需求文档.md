# 炒群平台开发需求文档

## 一、项目概述

### 1.1 项目名称
Telegram AI 炒群管理平台

### 1.2 项目目标
开发一个完整的Telegram群组AI管理平台，支持多账号、多群组管理，实现AI账号的自动化发言、智能回复、数据分析等功能。

### 1.3 技术栈建议
- **后端**: Python (FastAPI/Django)
- **前端**: React/Vue.js
- **数据库**: PostgreSQL/MySQL
- **消息队列**: Redis/RabbitMQ
- **Telegram SDK**: Telethon
- **AI服务**: OpenAI API (支持多模型)

---

## 二、核心功能需求

### 2.1 账号管理模块

#### 2.1.1 AI账号管理
- **功能描述**: 管理所有AI账号的登录、配置和状态
- **详细需求**:
  - 支持通过Telethon批量登录多个AI账号
  - 账号状态监控（在线/离线/异常）
  - 账号信息管理（昵称、头像、简介等）
  - 账号启用/禁用功能
  - 账号登录状态持久化（会话保存）
  - 支持账号分组管理

#### 2.1.2 账号配置管理
- **功能描述**: 配置每个AI账号的个性化参数
- **详细需求**:
  - **提示词设置**: 每个账号独立的系统提示词
  - **全局主线提示词应用**: 
    - 支持应用全局主线提示词到账号
    - 账号提示词与全局主线提示词的组合方式（前置/后置/替换）
    - 提示词优先级：账号独立提示词 > 全局主线提示词（可配置）
  - **一键批量设置**: 支持批量设置多个账号的提示词
  - **发言时间间隔**: 可配置的发言间隔（秒/分钟）
  - **聊天语气**: 预设语气模板（正式/轻松/幽默/专业等）
  - **AI模型配置**: 每个账号指定独立的API Key和模型
  - **优先级设置**: 账号优先级（1-10级，数字越大优先级越高）
  - **活跃时间周期配置**: 
    - 支持为每个AI账号独立配置活跃时间周期
    - 支持全局配置活跃时间周期（所有账号默认使用）
    - 时间周期配置方式：
      - 按星期配置（周一至周日）
      - 按日期范围配置（开始日期-结束日期）
      - 按时间段配置（每日的活跃时间段，如：09:00-18:00）
      - 支持多个时间段组合（如：工作日09:00-12:00和14:00-18:00）
    - 时间周期优先级：账号独立配置 > 全局配置
    - 在非活跃时间段内，AI账号不主动发言（@提及回复除外）
    - 支持时区配置（不同账号可设置不同时区）

---

### 2.2 群组管理模块

#### 2.2.1 群组管理
- **功能描述**: 管理所有Telegram群组
- **详细需求**:
  - 群组信息管理（群名、ID、类型等）
  - 群组添加/删除功能
  - 群组状态监控（是否可访问）
  - 群组分类/标签管理

#### 2.2.2 群组与账号关联
- **功能描述**: 为每个群组分配AI账号
- **详细需求**:
  - 支持一个群组分配多个AI账号
  - 支持一个AI账号加入多个群组
  - 群组内账号优先级管理
  - 群组内账号发言规则配置

---

### 2.3 发言管理模块

#### 2.3.1 智能发言
- **功能描述**: AI账号根据群内消息自动发言
- **详细需求**:
  - 监听群内消息（BOT消息、指定账号消息）
  - 根据消息内容生成讨论主题
  - 基于讨论主题生成相关回复
  - 支持引用之前的发言内容
  - 话题相关性检测和延续
  - **全局主线提示词应用**:
    - 所有AI账号的发言都遵循全局主线提示词设定的聊天框架
    - 主线提示词定义整体营销策略、品牌调性、核心话题方向
    - 账号独立提示词在主线提示词框架内进行个性化调整
    - 提示词组合策略：
      - **框架模式**：主线提示词作为框架，账号提示词填充细节
      - **叠加模式**：主线提示词 + 账号提示词，共同作用
      - **覆盖模式**：账号提示词完全覆盖主线提示词（特殊账号）
    - 支持主线提示词版本管理（历史版本、回滚功能）

#### 2.3.2 发言频率控制
- **功能描述**: 控制AI账号的发言频率和时间
- **详细需求**:
  - 可配置的发言频率（每分钟/每小时最多发言次数）
  - **活跃时间周期控制**:
    - 结合账号独立配置或全局配置的活跃时间周期
    - 在活跃时间周期内才允许主动发言
    - 非活跃时间段内仅响应@提及（可配置）
    - 支持临时调整活跃时间（紧急发言功能）
  - 时间段控制（允许发言的时间段）
  - 智能间隔算法（避免过于频繁）
  - 群组活跃度自适应调整

#### 2.3.3 定时任务
- **功能描述**: 在特定时间执行特定发言
- **详细需求**:
  - 定时任务创建/编辑/删除
  - 支持一次性任务和周期性任务
  - 任务执行状态监控
  - 任务执行日志记录

---

### 2.4 自动回复模块

#### 2.4.1 @提及回复
- **功能描述**: 当有人@AI账号时自动回复
- **详细需求**:
  - 检测@提及消息
  - 根据消息内容生成回复
  - 回复延迟设置（模拟真人回复）
  - 回复优先级（高于普通发言）

#### 2.4.2 关键词回复
- **功能描述**: 根据关键词触发自动回复
- **详细需求**:
  - 关键词规则配置
  - 支持正则表达式匹配
  - 回复模板管理
  - 回复频率限制

---

### 2.5 内容管理模块

#### 2.5.1 内容过滤
- **功能描述**: 过滤不适当或敏感内容
- **详细需求**:
  - 敏感词过滤列表
  - 内容审核规则配置
  - 自动拒绝发送不当内容
  - 内容审核日志记录

#### 2.5.2 黑名单管理
- **功能描述**: 管理AI账号的黑名单
- **详细需求**:
  - 用户黑名单（不回复指定用户）
  - 群组黑名单（不在指定群组发言）
  - 黑名单导入/导出
  - 黑名单生效时间设置

---

### 2.6 智能分析模块

#### 2.6.1 情感分析
- **功能描述**: 分析群内成员情绪并调整AI发言
- **详细需求**:
  - 实时情感分析（正面/中性/负面）
  - 根据情感调整发言语气
  - 情感趋势图表展示
  - 情感阈值告警

#### 2.6.2 话题监测
- **功能描述**: 监测AI账号当前讨论的话题
- **详细需求**:
  - 实时话题提取
  - 话题分类和标签
  - 话题热度分析
  - 话题切换检测

#### 2.6.3 学习优化
- **功能描述**: 根据反馈优化AI发言
- **详细需求**:
  - 收集群内成员反馈（点赞/回复/互动）
  - 分析发言效果（参与度、回复率等）
  - 自动优化提示词
  - 发言策略调整建议

---

### 2.7 多语言支持模块

#### 2.7.1 语言检测与切换
- **功能描述**: 根据群内语言自动切换AI发言语言
- **详细需求**:
  - 自动检测群内主要语言
  - 支持多语言提示词配置
  - 语言偏好设置（群组级别）
  - 翻译功能（可选）

---

### 2.8 数据统计模块

#### 2.8.1 发言记录
- **功能描述**: 记录和查看所有AI账号的发言
- **详细需求**:
  - 发言记录列表（时间、账号、群组、内容）
  - 发言记录搜索和筛选
  - 发言记录详情查看
  - 发言记录导出（CSV/Excel）

#### 2.8.2 统计分析
- **功能描述**: 统计AI账号和群组的活跃数据
- **详细需求**:
  - **账号统计**:
    - 发言次数统计
    - 活跃时间段分析
    - 回复率统计
    - 互动率统计
  - **群组统计**:
    - 群组活跃度
    - 成员参与度
    - 话题分布
    - 情感趋势
  - **综合统计**:
    - 账号表现排名
    - 群组活跃度排名
    - 话题热度排名

#### 2.8.3 报表生成
- **功能描述**: 定期生成统计报表
- **详细需求**:
  - 日报/周报/月报自动生成
  - 报表模板自定义
  - 报表邮件发送（可选）
  - 报表数据可视化（图表）

---

### 2.9 聊天记录模块

#### 2.9.1 记录导出
- **功能描述**: 导出群组聊天记录
- **详细需求**:
  - 支持导出指定时间段的记录
  - 支持导出指定群组的记录
  - 导出格式：CSV、Excel、JSON、TXT
  - 批量导出功能

#### 2.9.2 记录分析
- **功能描述**: 分析导出的聊天记录
- **详细需求**:
  - 关键词提取
  - 话题分析
  - 成员活跃度分析
  - 时间分布分析

---

## 三、管理前端需求

### 3.1 用户界面

#### 3.1.1 仪表盘（Dashboard）
- 系统概览（账号总数、群组总数、今日发言数等）
- 实时监控（在线账号、活跃群组）
- 快速操作入口
- 数据可视化图表

#### 3.1.2 账号管理页面
- 账号列表（表格展示）
- 账号添加/编辑/删除
- 账号批量操作
- 账号状态实时显示
- 账号配置快速编辑
- **账号提示词配置界面**:
  - 账号独立提示词编辑
  - 全局主线提示词预览和应用
  - 提示词组合模式选择（框架/叠加/覆盖）
  - 提示词预览和测试功能
  - 提示词模板库
- **账号活跃时间周期配置界面**:
  - 可视化时间周期配置（日历选择器、时间段选择器）
  - 支持复制其他账号的时间周期配置
  - 支持应用全局时间周期配置
  - 时间周期预览和测试功能

#### 3.1.3 群组管理页面
- 群组列表
- 群组添加/编辑/删除
- 群组与账号关联配置
- 群组状态监控

#### 3.1.4 发言配置页面
- 发言规则配置
- 定时任务管理
- 频率控制设置
- 时间段配置

#### 3.1.5 数据统计页面
- 发言记录查看
- 统计分析图表
- 报表查看和下载
- 数据筛选和搜索

#### 3.1.6 系统设置页面
- 全局配置
  - **全局主线提示词配置**: 
    - 设置整体群营销的聊天框架和策略
    - 定义品牌调性、核心话题方向、营销目标
    - 支持富文本编辑和提示词模板
    - 提示词预览和测试功能
    - 版本管理和历史记录
    - 一键应用到所有账号或指定账号组
  - **全局活跃时间周期配置**: 设置所有账号的默认活跃时间周期
  - 全局发言频率配置
  - 全局内容过滤规则
- 内容过滤规则
- 黑名单管理
- 系统日志查看

### 3.2 功能特性

#### 3.2.1 实时更新
- WebSocket实时推送账号状态
- 实时显示发言记录
- 实时统计更新

#### 3.2.2 批量操作
- 批量设置提示词
- 批量配置账号
- 批量导入/导出

#### 3.2.3 权限管理
- 多用户支持
- 角色权限控制
- 操作日志记录

---

## 四、技术架构需求

### 4.1 系统架构

#### 4.1.1 后端架构
- RESTful API设计
- 异步任务处理（Celery）
- 消息队列（Redis/RabbitMQ）
- 数据库设计（关系型+时序数据库）

#### 4.1.2 前端架构
- 响应式设计（支持PC和移动端）
- 组件化开发
- 状态管理（Redux/Vuex）
- 实时通信（WebSocket）

#### 4.1.3 数据存储
- 账号信息、配置信息（PostgreSQL）
- 发言记录、聊天记录（PostgreSQL + 时序数据库）
- 缓存数据（Redis）
- 文件存储（本地/OSS）

### 4.2 性能要求

#### 4.2.1 并发处理
- 支持同时管理100+ AI账号
- 支持同时监听1000+ 群组
- 消息处理延迟 < 2秒

#### 4.2.2 稳定性
- 系统可用性 > 99%
- 自动重连机制
- 异常恢复机制
- 数据备份机制

---

## 五、安全需求

### 5.1 数据安全
- API Key加密存储
- 会话信息加密
- 敏感数据脱敏
- 操作审计日志

### 5.2 访问控制
- 用户认证（JWT）
- 权限控制（RBAC）
- IP白名单（可选）
- 操作频率限制

---

## 六、非功能性需求

### 6.1 可扩展性
- 支持插件机制
- 支持自定义AI模型
- 支持第三方服务集成

### 6.2 可维护性
- 代码规范
- 完善的日志系统
- 错误处理机制
- 文档完善

### 6.3 用户体验
- 界面友好直观
- 操作简单便捷
- 响应速度快
- 错误提示清晰

---

## 七、开发阶段规划

### 阶段一：核心功能（MVP）
1. 账号管理（登录、配置）
2. 群组管理
3. 基础发言功能
4. 简单的前端界面

### 阶段二：增强功能
1. 自动回复
2. 定时任务
3. 内容过滤
4. 基础统计

### 阶段三：智能功能
1. 情感分析
2. 话题监测
3. 学习优化
4. 多语言支持

### 阶段四：完善优化
1. 高级统计报表
2. 性能优化
3. 用户体验优化
4. 安全加固

---

## 八、数据模型设计（概要）

### 8.1 核心实体
- **AI账号** (ai_accounts)
- **群组** (groups)
- **账号-群组关联** (account_groups)
- **发言记录** (messages)
- **配置** (configurations)
- **定时任务** (scheduled_tasks)
- **黑名单** (blacklists)
- **统计报表** (reports)
- **活跃时间周期** (active_time_periods)
  - 账号级别时间周期配置
  - 全局时间周期配置

### 8.2 关系设计
- 账号 1:N 群组（通过关联表）
- 账号 1:N 发言记录
- 群组 1:N 发言记录
- 账号 1:1 配置

---

## 九、API设计（概要）

### 9.1 账号管理API
- `POST /api/accounts` - 添加账号
- `GET /api/accounts` - 获取账号列表
- `PUT /api/accounts/{id}` - 更新账号
- `DELETE /api/accounts/{id}` - 删除账号
- `POST /api/accounts/{id}/login` - 登录账号
- `POST /api/accounts/batch-update` - 批量更新

### 9.2 群组管理API
- `POST /api/groups` - 添加群组
- `GET /api/groups` - 获取群组列表
- `PUT /api/groups/{id}` - 更新群组
- `POST /api/groups/{id}/assign-accounts` - 分配账号

### 9.3 发言管理API
- `GET /api/messages` - 获取发言记录
- `POST /api/messages/send` - 手动发送消息
- `GET /api/messages/statistics` - 获取统计数据

### 9.4 配置管理API
- `GET /api/configs` - 获取配置
- `PUT /api/configs` - 更新配置
- `GET /api/configs/global-active-period` - 获取全局活跃时间周期
- `PUT /api/configs/global-active-period` - 更新全局活跃时间周期

### 9.5 活跃时间周期API
- `GET /api/accounts/{id}/active-period` - 获取账号活跃时间周期
- `PUT /api/accounts/{id}/active-period` - 更新账号活跃时间周期
- `POST /api/accounts/{id}/active-period/apply-global` - 应用全局时间周期到账号
- `POST /api/accounts/batch-active-period` - 批量设置账号活跃时间周期
- `GET /api/accounts/{id}/active-status` - 获取账号当前是否在活跃时间段

### 9.6 全局主线提示词API
- `GET /api/configs/global-main-prompt` - 获取全局主线提示词
- `PUT /api/configs/global-main-prompt` - 更新全局主线提示词
- `GET /api/configs/global-main-prompt/versions` - 获取提示词版本历史
- `POST /api/configs/global-main-prompt/rollback` - 回滚到指定版本
- `POST /api/configs/global-main-prompt/preview` - 预览提示词效果
- `POST /api/configs/global-main-prompt/apply` - 应用主线提示词到账号
- `POST /api/configs/global-main-prompt/batch-apply` - 批量应用主线提示词
- `GET /api/accounts/{id}/prompt-combined` - 获取账号组合后的完整提示词

---

## 十、测试需求

### 10.1 功能测试
- 单元测试
- 集成测试
- 端到端测试

### 10.2 性能测试
- 压力测试
- 并发测试
- 负载测试

### 10.3 安全测试
- 漏洞扫描
- 渗透测试
- 数据安全测试

---

## 十一、部署需求

### 11.1 部署环境
- 支持Docker容器化部署
- 支持Linux服务器部署
- 支持云服务器部署

### 11.2 监控告警
- 系统监控（CPU、内存、磁盘）
- 应用监控（API响应时间、错误率）
- 告警通知（邮件、短信、钉钉等）

---

## 十二、功能增强建议

基于当前功能，以下补充功能可以进一步提升AI群营销工具的实用性和竞争力：

### 12.1 内容管理增强
- **内容素材库**: 统一管理文本模板、图片、链接等营销素材，支持标签分类和智能推荐
- **内容模板系统**: 预设回复模板，支持变量替换和模板组合，提升内容复用率

### 12.2 用户管理增强
- **用户画像系统**: 识别用户角色、标签，分析用户行为习惯，实现精准营销
- **用户关系管理（CRM）**: 用户生命周期管理，基于用户画像的精准推送

### 12.3 监控和告警系统
- **关键词监控**: 监控特定关键词，自动触发响应或通知
- **竞品监控**: 监控竞争对手动态，分析竞品策略
- **实时告警系统**: 账号异常、群组异常、内容异常等实时告警

### 12.4 营销活动管理
- **活动管理**: 创建、执行、跟踪营销活动，评估活动效果和ROI
- **A/B测试框架**: 测试不同策略和内容的效果，数据驱动优化

### 12.5 成本管理
- **AI API成本统计**: 按账号、群组、时间段统计API调用成本
- **成本控制**: 设置预算、成本告警、自动限流
- **成本优化**: 识别高成本场景，提供优化建议

### 12.6 协作和权限管理
- **多用户协作**: 支持多人协作管理，角色权限控制（超级管理员、管理员、操作员、查看者）
- **操作日志**: 记录所有操作，支持操作审计

### 12.7 数据分析增强
- **高级数据分析**: 多维度分析、对比分析、趋势分析、关联分析
- **数据可视化增强**: 丰富的图表类型、交互式图表、自定义仪表盘
- **ROI分析**: 营销效果和投资回报分析，优化建议

### 12.8 自动化工作流
- **工作流引擎**: 可视化工作流设计，自动化复杂业务流程
- **智能推荐系统**: 推荐最佳发言时机、内容、策略

### 12.9 安全和合规
- **内容审核增强**: 多级审核、审核规则配置、审核流程管理
- **数据安全和隐私**: 数据加密、备份恢复、隐私保护（GDPR合规）

### 12.10 集成和扩展
- **第三方集成**: CRM、分析工具、通知系统等集成
- **API开放**: RESTful API、Webhook支持、SDK提供
- **插件系统**: 支持插件扩展，插件市场

### 12.11 移动端支持
- **移动端应用**: 移动端管理应用，支持核心功能查看和便捷操作

**详细的功能补充建议请参考**: [功能补充建议文档](./功能补充建议.md)

---

## 十三、后续扩展（可选）

1. 支持其他即时通讯平台（微信、QQ等）
2. 支持更多AI模型（Claude、Gemini等）
3. 支持自定义AI训练
4. 支持API开放给第三方
5. 支持移动端APP

---

## 附录：需求优先级

### P0（必须实现）
- 账号管理
- 群组管理
- 基础发言功能
- 发言记录查看
- 基础前端界面

### P1（重要）
- 自动回复
- 定时任务
- 内容过滤
- 基础统计
- 黑名单
- 全局主线提示词配置

### P2（增强）
- 情感分析
- 话题监测
- 学习优化
- 多语言支持
- 高级报表

### P3（优化）
- 性能优化
- 用户体验优化
- 高级功能扩展

